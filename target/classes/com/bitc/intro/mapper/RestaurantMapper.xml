<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bitc.intro.mapper.RestaurantMapper">

	<insert id="insert">
		INSERT INTO restaurant (name , district , address ,
		phonenum , url , mainmenu , img , content , spot_id)
		VALUES (#{name} , #{district} , #{address} , #{phonenum} , #{url} ,
		#{mainmenu} , #{img} , #{content} , #{spot_id})
	</insert>
	
	<select id="getRestaurantById" resultType="com.bitc.intro.domain.Restaurant">
		SELECT * FROM restaurant WHERE rid = #{rid}
	</select>

	<select id="getRestaurants"
		resultType="com.bitc.intro.domain.Restaurant">
		SELECT * FROM restaurant ORDER BY id DESC
	</select>

	<delete id="deleteById">
		DELETE FROM restaurant WHERE id = #{rid}
	</delete>

	<!-- 업데이트 이름, 주소, 전번, 홈페이지, 메뉴, 사진, 상세 / spot_id는 고정 -->
	<update id="updateRestaurantById">
		UPDATE restaurant 
		SET name=#{name} , address=#{address} , phonenum=#{phonenum} , url=#{url} , mainmenu=${mainmenu} , img=#{img} , content=#{content} , spot_id=#{spot_id}
		WHERE rid=#{rid}
	</update>
	
	<!-- 관광지 주변 식당 별점 추가해야함 -->
	<select id="getRestaurantsBySpotIdWithPage" resultType="com.bitc.intro.domain.Restaurant">
		SELECT *
		FROM (select hotspot.id hid , restaurant.id rid , restaurant.img rimg , restaurant.name rname
		FROM hotspot inner join restaurant
		WHERE hotspot.district = restaurant.district) newtable
		WHERE newtable.hid = #{id} LiMIT #{startPage} , #{amount}
	</select>
	
	<!-- 전체 글 개수 -->
	<select id="getTotalCountBySpotId" resultType="int">
		SELECT COUNT(*)
		FROM (select hotspot.id hid , restaurant.id rid , restaurant.img rimg , restaurant.name rname
		FROM hotspot inner join restaurant
		WHERE hotspot.district = restaurant.district) newtable
		WHERE newtable.hid = #{id}
	</select>

</mapper>